# 演练4：基于大模型的架构文档生成与详细设计

## 背景介绍

随着软件系统复杂度的不断提升，传统的手工架构设计和文档编写方式已经难以满足快速迭代的需求。本演练将基于**航空票务系统**这一实际场景，展示如何运用AI大模型进行软件架构设计，生成完整的SAD（Software Architecture Document）文档，并通过AI赋能完成详细设计产物的生成。

## 项目背景：智能航空票务系统

### 业务场景

民航凯亚需要构建一个现代化的航空票务系统，支持：

- 多航司票务整合
- 实时价格查询与比较
- 智能推荐与个性化服务
- 移动端与Web端全渠道支持
- 与现有航班管理系统的无缝集成

### 核心需求

1. **高并发处理**：支持10万+用户同时在线查询和预订
2. **实时数据同步**：与各航司系统实时数据交换
3. **智能化服务**：基于用户行为的智能推荐
4. **多渠道支持**：Web、移动APP、小程序、API开放平台
5. **安全合规**：满足民航局数据安全和支付合规要求

## 实践目标

通过本演练，学员将掌握：

1. 使用AI大模型进行系统架构设计的方法论
2. 基于提示词工程生成专业级SAD文档
3. AI辅助的详细设计产物生成（类图、时序图、组件图等）
4. 架构设计评审与迭代优化的AI赋能方法

## 第一阶段：AI驱动的架构分析(必须)

### 步骤1：需求到架构的AI转换

**AI提示词模板：**

```
作为资深架构师，请基于以下业务需求，进行系统架构分析：

【业务背景】
航空票务系统，需要支持多航司票务整合、实时价格查询、智能推荐等功能

【核心需求】
1. 高并发处理（10万+并发用户）
2. 实时数据同步（与各航司系统）
3. 智能化服务（用户行为分析和推荐）
4. 多渠道支持（Web/App/小程序/API）
5. 安全合规（民航局标准）

请从以下维度进行分析：
1. 系统边界识别
2. 核心领域划分
3. 关键技术挑战
4. 架构风格选择建议
5. 非功能性需求分解

输出格式：结构化分析报告
```

**实践任务：**

> 使用上述提示词，让学员通过AI工具（如Deepseek、Claude等）生成初步的架构分析报告，并讨论AI输出的合理性。

## 第二阶段：SAD文档智能生成

### 步骤2：结构化SAD文档生成(必须)

**核心提示词策略：**

```
请为航空票务系统生成完整的软件架构设计文档（SAD），包含以下章节：

1. 引言
   - 1.1 目的
   - 1.2 范围
   - 1.3 定义、首字母缩写词和缩略语
   - 1.4 参考资料
   - 1.5 概述

2. 架构表示
   - 2.1 架构视图概述
   - 2.2 视图间关系

3. 架构目标和约束
   - 3.1 架构目标
   - 3.2 架构约束
   - 3.3 技术约束

4. 用例视图
   - 4.1 主要用例
   - 4.2 用例实现

5. 逻辑视图
   - 5.1 概述
   - 5.2 架构上重要的设计包
   - 5.3 层次分解

6. 进程视图
   - 6.1 并发模型
   - 6.2 进程分解

7. 部署视图
   - 7.1 物理架构
   - 7.2 软件到硬件的映射

8. 实现视图
   - 8.1 概述
   - 8.2 层次分解

9. 数据视图
   - 9.1 数据架构
   - 9.2 数据分布策略

10. 架构质量
    - 10.1 性能
    - 10.2 可用性
    - 10.3 安全性
    - 10.4 可扩展性

请确保文档专业、详细，符合IEEE 1016标准。
```

### 步骤3：分章节深度生成

为保证文档质量，建议采用分章节生成策略：

**逻辑视图生成示例：**

```
请为航空票务系统详细设计逻辑视图章节，包括：

1. 系统整体逻辑架构图（使用PlantUML格式）
2. 核心业务领域识别：
   - 用户管理域
   - 航班查询域
   - 订票交易域
   - 支付结算域
   - 消息通知域
   - 数据分析域

3. 各领域的核心业务组件设计
4. 领域间的依赖关系和数据流
5. 关键设计模式的应用

输出要求：
- 包含完整的PlantUML代码
- 每个组件的职责描述
- 关键接口定义
```

## 第三阶段：详细设计的AI生成

### 步骤4：核心领域类图设计

**订票交易域类图生成：**

```
请为航空票务系统的"订票交易域"生成详细的类图设计：

业务流程：
1. 用户搜索航班
2. 选择航班和舱位
3. 填写乘客信息
4. 确认订单信息
5. 执行支付
6. 生成电子票据

要求生成：
1. 完整的PlantUML类图代码
2. 核心实体类：
   - FlightSearchRequest
   - Flight
   - Seat
   - Passenger
   - Order
   - Payment
   - Ticket
   
3. 关键业务服务类：
   - FlightSearchService
   - BookingService
   - PaymentService
   - TicketService

4. 类之间的关联关系
5. 关键方法签名和属性定义
6. 设计模式应用说明
```

### 步骤5：关键时序图生成

**订票流程时序图：**

```
生成"用户订票核心流程"的时序图，参与对象包括：
- User（用户）
- WebController（Web控制器）
- FlightSearchService（航班查询服务）
- BookingService（订票服务）
- PaymentService（支付服务）
- NotificationService（通知服务）
- ExternalAirlineAPI（外部航司接口）

关键交互步骤：
1. 用户搜索航班
2. 系统查询各航司数据
3. 返回航班列表
4. 用户选择并预订
5. 验证座位可用性
6. 创建订单
7. 执行支付
8. 生成票据
9. 发送确认通知

输出PlantUML时序图代码和详细说明。
```

### 步骤6：系统组件图设计

**高层组件架构：**

```
为航空票务系统设计组件架构图，体现：

1. 前端层：
   - Web Portal
   - Mobile App
   - WeChat Mini Program
   - API Gateway

2. 业务服务层：
   - User Service
   - Flight Service
   - Booking Service
   - Payment Service
   - Notification Service
   - Analytics Service

3. 基础设施层：
   - Message Queue
   - Cache Layer
   - Database Cluster
   - File Storage
   - Monitoring & Logging

4. 外部集成：
   - Airline APIs
   - Payment Gateways
   - SMS/Email Services
   - Third-party Analytics

请生成PlantUML组件图，标注接口关系和数据流向。
```

## 第四阶段：架构评审与优化

### 步骤7：AI辅助架构评审

**架构评审提示词：**

```
作为架构评审专家，请对以上设计的航空票务系统架构进行全面评审：

评审维度：
1. 架构完整性检查
   - 是否覆盖所有核心业务场景
   - 非功能性需求是否充分考虑
   - 技术选型是否合理

2. 架构一致性评估
   - 各视图间是否协调一致
   - 设计决策是否前后呼应
   - 接口定义是否规范

3. 架构风险识别
   - 潜在的性能瓶颈点
   - 单点故障风险
   - 扩展性限制
   - 安全漏洞风险

4. 改进建议
   - 架构优化方案
   - 技术选型调整建议
   - 实施路径优化

输出格式：结构化评审报告，包含问题清单和改进建议。
```

### 步骤8：架构迭代优化

基于评审结果，使用AI进行架构迭代：

```
基于以下架构评审问题，请提供优化方案：

【识别的主要问题】
1. 订票服务存在性能瓶颈
2. 数据一致性处理不完善  
3. 外部服务调用缺乏容错机制
4. 缓存策略需要优化

【约束条件】
- 不能大幅改变现有技术栈
- 必须保证数据强一致性
- 改造成本要控制在合理范围

请提供：
1. 针对性的解决方案
2. 修改后的架构图
3. 实施优先级和风险评估
```

## 第五阶段：文档集成与交付

### 步骤9：完整文档整合

将AI生成的各部分内容整合成完整的交付物：

1. **完整SAD文档**

   - 规范化格式调整
   - 图表编号和交叉引用
   - 术语表和索引生成
2. **详细设计文档**

   - 领域模型设计
   - 接口规范定义
   - 数据库设计
   - 部署架构设计
3. **架构决策记录（ADR）**

   - 关键技术选型理由
   - 架构模式应用说明
   - 风险评估和应对策略

## 扩展思考

### 思考点1：AI生成内容的质量保证

- 如何验证AI生成架构设计的正确性？
- 什么情况下需要人工干预和调整？
- 如何建立AI辅助设计的质量检查流程？

### 思考点2：架构演进与AI的结合

- 如何使用AI进行架构债务识别？
- 微服务拆分决策中AI能发挥什么作用？
- 架构重构的AI辅助策略有哪些？

### 思考点3：团队协作中的AI工具应用

- 如何在架构评审会议中有效使用AI？
- 不同角色（架构师、开发者、测试）如何协同使用AI工具？
- AI生成的文档如何进行版本管理和维护？

### 思考点4：行业特定架构模式

- 航空业务的特殊架构需求有哪些？
- 如何让AI学习和应用行业最佳实践？
- 合规性要求如何融入AI辅助设计流程？

## 学习资源

### 推荐阅读

- 《软件架构实践》- 第4版
- 《微服务架构设计模式》
- 《架构整洁之道》
- 《领域驱动设计》
